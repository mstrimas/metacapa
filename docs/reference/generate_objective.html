<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Generate objective function — generate_objective • metacapa</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
<meta property="og:title" content="Generate objective function — generate_objective" />

<meta property="og:description" content="Generate an objective function to perform the metapopulation capacity-based
conservation prioritization developed by Strimas-Mackey and Brodie (2018).
This objective function maximizes the average metapopulation capacity across
species for a fixed budget. There is an optional additional term, similar to
the boundary term in Marxan, that can be used to favour more compact
solutions." />
<meta name="twitter:card" content="summary" />
<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">metacapa</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/mstrimas/metacapa">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Generate objective function</h1>
    <small>Source: <a href='https:/github.com/mstrimas/metacapa/blob/master/R/generate-objective.r'><code>R/generate-objective.r</code></a></small>
    </div>

    
    <p>Generate an objective function to perform the metapopulation capacity-based
conservation prioritization developed by Strimas-Mackey and Brodie (2018).
This objective function maximizes the average metapopulation capacity across
species for a fixed budget. There is an optional additional term, similar to
the boundary term in Marxan, that can be used to favour more compact
solutions.</p>
    

    <pre class="usage"><span class='fu'>generate_objective</span>(<span class='no'>pu</span>, <span class='no'>f</span>, <span class='no'>budget</span>, <span class='no'>delta</span>, <span class='kw'>blm</span> <span class='kw'>=</span> <span class='fl'>0</span>, <span class='kw'>scale</span> <span class='kw'>=</span> <span class='fu'>rep</span>(<span class='fl'>1</span>, <span class='fu'>length</span>(<span class='no'>f</span>)),
  <span class='kw'>benefit</span> <span class='kw'>=</span> <span class='kw'>function</span>(<span class='no'>y</span>) <span class='no'>y</span>, <span class='kw'>cost</span> <span class='kw'>=</span> <span class='st'>"cost"</span>, <span class='kw'>units</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"km"</span>, <span class='st'>"m"</span>),
  <span class='kw'>parallel</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>pu</th>
      <td><p><a href='http://www.rdocumentation.org/packages/raster/topics/Raster-classes'>raster::RasterStack</a>, <a href='http://www.rdocumentation.org/packages/sp/topics/SpatialPolygons'>sp::SpatialPolygonsDataFrame</a>, or
<a href='http://www.rdocumentation.org/packages/sf/topics/sf'>sf::sf</a> object; planning units and representation levels of features as
layers (raster inputs) or columns (vector inputs).</p></td>
    </tr>
    <tr>
      <th>f</th>
      <td><p>named list of dispersal survival functions with names matching the
layer/column names in <code>pu</code>.</p></td>
    </tr>
    <tr>
      <th>budget</th>
      <td><p>numeric; the target budget for the prioritization exercise.</p></td>
    </tr>
    <tr>
      <th>delta</th>
      <td><p>numeric; a scale factor to apply to the budget term in the
objective function that determines. To use simulated annealing for the
optimization, the budget constraint must be incorporated directly into the
objective function. This argument determines the relative importance to be
placed on maximizing the metapopulation capacity compared to meeting the
budget constraint.</p></td>
    </tr>
    <tr>
      <th>blm</th>
      <td><p>numeric; a scale factor to apply to the perimeter term in the
objective function that determines the relative importance to be
placed on maximizing the metapopulation capacity compared to producing more
compact solutions.</p></td>
    </tr>
    <tr>
      <th>scale</th>
      <td><p>numeric; vales to rescale the metapopulation capacity by, e.g.
to normalize them between 0-1 one can scale by the maximum,
species-specific metapopulation capacity given by selecting all planning
units. This should be a vector of length 1 or equal in length to the number
of features.</p></td>
    </tr>
    <tr>
      <th>benefit</th>
      <td><p>function; a function to apply to the scaled metapopulation
capacity before averaging across species. Often a saturating function is
used to ensure that less value is given to changes in metapopulation
capacity for species that are already near their maximum.</p></td>
    </tr>
    <tr>
      <th>cost</th>
      <td><p>name of the cost column or layer in the planning unit object,
<code>pu</code>, a numeric vector of costs in the same order as the rows of <code>pu</code> (for
vector planning units), or a <code>RasterLayer</code> of costs (for <code>Raster</code> planning
units.</p></td>
    </tr>
    <tr>
      <th>units</th>
      <td><p>character; metapopulation capacity depends on the units used for
the areas and distances, this argument determines whether these are
measured in meters or kilometers.</p></td>
    </tr>
    <tr>
      <th>parallel</th>
      <td><p>logical; whether to parallelize the metapopulation capacity
calculations over the species. Parallelization is accomplished using
<code><a href='http://www.rdocumentation.org/packages/foreach/topics/foreach'>foreach::foreach()</a></code> and requires registering a parallel backend with
<code><a href='http://www.rdocumentation.org/packages/doParallel/topics/registerDoParallel'>doParallel::registerDoParallel()</a></code> prior to calling this function.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A function that, given a logical vector specifying which planning
units are selected, returns the corresponding objective function value. If
the objective function is called with <code>components = TRUE</code>, then a list is
returned with the three components of the object function:</p><ul>
<li><p><code>mc</code>: the metapoplation capacity of each species.</p></li>
<li><p><code>cost</code>: the cost of the reserve network.</p></li>
<li><p><code>perimeter</code>: the total perimeter length, in the specified units, of the
reserve network.</p></li>
</ul>

    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># generate features</span>
<span class='no'>r</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>raster</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/raster/topics/raster'>raster</a></span>(<span class='kw'>nrows</span> <span class='kw'>=</span> <span class='fl'>10</span>, <span class='kw'>ncols</span> <span class='kw'>=</span> <span class='fl'>10</span>, <span class='kw'>crs</span> <span class='kw'>=</span> <span class='st'>"+proj=aea"</span>,
                    <span class='kw'>vals</span> <span class='kw'>=</span> <span class='fu'>sample</span>(<span class='fl'>0</span>:<span class='fl'>1</span>, <span class='fl'>100</span>, <span class='kw'>replace</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>))
<span class='no'>s</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>raster</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/raster/topics/stack'>stack</a></span>(<span class='no'>r</span>, <span class='no'>r</span>, <span class='no'>r</span>)
<span class='no'>s</span><span class='kw'>[[</span><span class='fl'>2</span>]][] <span class='kw'>&lt;-</span> <span class='fu'>sample</span>(<span class='fl'>0</span>:<span class='fl'>1</span>, <span class='fl'>100</span>, <span class='kw'>replace</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>prob</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>0.6</span>, <span class='fl'>0.4</span>))
<span class='no'>s</span><span class='kw'>[[</span><span class='fl'>3</span>]][] <span class='kw'>&lt;-</span> <span class='fu'>sample</span>(<span class='fl'>0</span>:<span class='fl'>1</span>, <span class='fl'>100</span>, <span class='kw'>replace</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>prob</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>0.8</span>, <span class='fl'>0.2</span>))
<span class='fu'>names</span>(<span class='no'>s</span>) <span class='kw'>&lt;-</span> <span class='fu'>c</span>(<span class='st'>"a"</span>, <span class='st'>"b"</span>, <span class='st'>"c"</span>)
<span class='no'>features</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>raster</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/raster/topics/rasterToPolygons'>rasterToPolygons</a></span>(<span class='no'>s</span>)
<span class='no'>features</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>sf</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/sf/topics/st_as_sf'>st_as_sf</a></span>(<span class='no'>features</span>)
<span class='co'># cost</span>
<span class='no'>features</span>$<span class='no'>cost</span> <span class='kw'>&lt;-</span> <span class='fu'>runif</span>(<span class='fu'>nrow</span>(<span class='no'>features</span>))
<span class='co'># dispersal functions</span>
<span class='no'>disp_f</span> <span class='kw'>&lt;-</span> <span class='fu'>list</span>(<span class='kw'>a</span> <span class='kw'>=</span> <span class='fu'><a href='dispersal.html'>dispersal_negexp</a></span>(<span class='fl'>1</span> / <span class='fl'>0.01</span>),
               <span class='kw'>b</span> <span class='kw'>=</span> <span class='fu'><a href='dispersal.html'>dispersal_negexp</a></span>(<span class='fl'>1</span> / <span class='fl'>0.005</span>),
               <span class='kw'>c</span> <span class='kw'>=</span> <span class='fu'><a href='dispersal.html'>dispersal_negexp</a></span>(<span class='fl'>1</span> / <span class='fl'>0.02</span>))

<span class='co'># calculate scale factors</span>
<span class='no'>scale_mc</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='mc_reserve.html'>mc_reserve</a></span>(<span class='no'>features</span>, <span class='fu'>rep</span>(<span class='fl'>TRUE</span>, <span class='fu'>nrow</span>(<span class='no'>features</span>)), <span class='no'>disp_f</span>)

<span class='co'># set budget at 50% of total</span>
<span class='no'>budget</span> <span class='kw'>&lt;-</span> <span class='fl'>0.5</span> * <span class='fu'>sum</span>(<span class='no'>features</span>$<span class='no'>cost</span>)

<span class='co'># build an objective function</span>
<span class='no'>objective</span> <span class='kw'>&lt;-</span> <span class='fu'>generate_objective</span>(<span class='no'>features</span>, <span class='no'>disp_f</span>, <span class='no'>budget</span>, <span class='kw'>delta</span> <span class='kw'>=</span> <span class='fl'>0.001</span>,
                                <span class='kw'>blm</span> <span class='kw'>=</span> <span class='fl'>0.001</span>)

<span class='co'># calculate objective</span>
<span class='no'>selected</span> <span class='kw'>&lt;-</span> <span class='fu'>sample</span>(<span class='fu'>c</span>(<span class='fl'>FALSE</span>, <span class='fl'>TRUE</span>), <span class='fl'>100</span>, <span class='kw'>replace</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>prob</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>0.7</span>, <span class='fl'>0.3</span>))
<span class='fu'>objective</span>(<span class='no'>selected</span>, <span class='kw'>components</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</div><div class='output co'>#&gt; $mc
#&gt;           a           b           c 
#&gt; 1.48870e-04 8.57889e-05 5.75590e-05 
#&gt; 
#&gt; $cost
#&gt; [1] 16.64237
#&gt; 
#&gt; $perimeter
#&gt; [1] 2.412
#&gt; </div><div class='input'><span class='fu'>objective</span>(<span class='no'>selected</span>)</div><div class='output co'>#&gt; [1] -0.002119782</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by <a href='http://strimas.com'>Matthew Strimas-Mackey</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>

